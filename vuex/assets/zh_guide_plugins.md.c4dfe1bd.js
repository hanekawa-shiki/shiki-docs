import{_ as n,y as s,x as a,W as t}from"./plugin-vue_export-helper.0b0d78d5.js";const g='{"title":"\u63D2\u4EF6","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u5728\u63D2\u4EF6\u5185\u63D0\u4EA4 Mutation","slug":"\u5728\u63D2\u4EF6\u5185\u63D0\u4EA4-mutation"},{"level":2,"title":"\u751F\u6210 State \u5FEB\u7167","slug":"\u751F\u6210-state-\u5FEB\u7167"},{"level":2,"title":"\u5185\u7F6E Logger \u63D2\u4EF6","slug":"\u5185\u7F6E-logger-\u63D2\u4EF6"}],"relativePath":"zh/guide/plugins.md","lastUpdated":1702210160144}',p={},o=t(`<h1 id="\u63D2\u4EF6" tabindex="-1">\u63D2\u4EF6 <a class="header-anchor" href="#\u63D2\u4EF6" aria-hidden="true">#</a></h1><div class="scrimba"><a href="https://scrimba.com/p/pnyzgAP/cvp8ZkCR" target="_blank" rel="noopener noreferrer">\u5728 Scrimba \u4E0A\u5C1D\u8BD5\u8FD9\u8282\u8BFE</a></div><p>Vuex \u7684 store \u63A5\u53D7 <code>plugins</code> \u9009\u9879\uFF0C\u8FD9\u4E2A\u9009\u9879\u66B4\u9732\u51FA\u6BCF\u6B21 mutation \u7684\u94A9\u5B50\u3002Vuex \u63D2\u4EF6\u5C31\u662F\u4E00\u4E2A\u51FD\u6570\uFF0C\u5B83\u63A5\u6536 store \u4F5C\u4E3A\u552F\u4E00\u53C2\u6570\uFF1A</p><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token function-variable function">myPlugin</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">store</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// \u5F53 store \u521D\u59CB\u5316\u540E\u8C03\u7528</span>
  store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">mutation<span class="token punctuation">,</span> state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u6BCF\u6B21 mutation \u4E4B\u540E\u8C03\u7528</span>
    <span class="token comment">// mutation \u7684\u683C\u5F0F\u4E3A { type, payload }</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>\u7136\u540E\u50CF\u8FD9\u6837\u4F7F\u7528\uFF1A</p><div class="language-js"><pre><code><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>myPlugin<span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="\u5728\u63D2\u4EF6\u5185\u63D0\u4EA4-mutation" tabindex="-1">\u5728\u63D2\u4EF6\u5185\u63D0\u4EA4 Mutation <a class="header-anchor" href="#\u5728\u63D2\u4EF6\u5185\u63D0\u4EA4-mutation" aria-hidden="true">#</a></h2><p>\u5728\u63D2\u4EF6\u4E2D\u4E0D\u5141\u8BB8\u76F4\u63A5\u4FEE\u6539\u72B6\u6001\u2014\u2014\u7C7B\u4F3C\u4E8E\u7EC4\u4EF6\uFF0C\u53EA\u80FD\u901A\u8FC7\u63D0\u4EA4 mutation \u6765\u89E6\u53D1\u53D8\u5316\u3002</p><p>\u901A\u8FC7\u63D0\u4EA4 mutation\uFF0C\u63D2\u4EF6\u53EF\u4EE5\u7528\u6765\u540C\u6B65\u6570\u636E\u6E90\u5230 store\u3002\u4F8B\u5982\uFF0C\u540C\u6B65 websocket \u6570\u636E\u6E90\u5230 store\uFF08\u4E0B\u9762\u662F\u4E2A\u5927\u6982\u4F8B\u5B50\uFF0C\u5B9E\u9645\u4E0A <code>createWebSocketPlugin</code> \u65B9\u6CD5\u53EF\u4EE5\u6709\u66F4\u591A\u9009\u9879\u6765\u5B8C\u6210\u590D\u6742\u4EFB\u52A1\uFF09\uFF1A</p><div class="language-js"><pre><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">createWebSocketPlugin</span> <span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">store</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;data&#39;</span><span class="token punctuation">,</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">&#39;receiveData&#39;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token parameter">mutation</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>mutation<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">&#39;UPDATE_DATA&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        socket<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&#39;update&#39;</span><span class="token punctuation">,</span> mutation<span class="token punctuation">.</span>payload<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js"><pre><code><span class="token keyword">const</span> plugin <span class="token operator">=</span> <span class="token function">createWebSocketPlugin</span><span class="token punctuation">(</span>socket<span class="token punctuation">)</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  state<span class="token punctuation">,</span>
  mutations<span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>plugin<span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="\u751F\u6210-state-\u5FEB\u7167" tabindex="-1">\u751F\u6210 State \u5FEB\u7167 <a class="header-anchor" href="#\u751F\u6210-state-\u5FEB\u7167" aria-hidden="true">#</a></h2><p>\u6709\u65F6\u5019\u63D2\u4EF6\u9700\u8981\u83B7\u5F97\u72B6\u6001\u7684\u201C\u5FEB\u7167\u201D\uFF0C\u6BD4\u8F83\u6539\u53D8\u7684\u524D\u540E\u72B6\u6001\u3002\u60F3\u8981\u5B9E\u73B0\u8FD9\u9879\u529F\u80FD\uFF0C\u4F60\u9700\u8981\u5BF9\u72B6\u6001\u5BF9\u8C61\u8FDB\u884C\u6DF1\u62F7\u8D1D\uFF1A</p><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token function-variable function">myPluginWithSnapshot</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">store</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> prevState <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">cloneDeep</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>state<span class="token punctuation">)</span>
  store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">mutation<span class="token punctuation">,</span> state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> nextState <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">cloneDeep</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>

    <span class="token comment">// \u6BD4\u8F83 prevState \u548C nextState...</span>

    <span class="token comment">// \u4FDD\u5B58\u72B6\u6001\uFF0C\u7528\u4E8E\u4E0B\u4E00\u6B21 mutation</span>
    prevState <span class="token operator">=</span> nextState
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>\u751F\u6210\u72B6\u6001\u5FEB\u7167\u7684\u63D2\u4EF6\u5E94\u8BE5\u53EA\u5728\u5F00\u53D1\u9636\u6BB5\u4F7F\u7528</strong>\uFF0C\u4F7F\u7528 webpack \u6216 Browserify\uFF0C\u8BA9\u6784\u5EFA\u5DE5\u5177\u5E2E\u6211\u4EEC\u5904\u7406\uFF1A</p><div class="language-js"><pre><code><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&#39;production&#39;</span>
    <span class="token operator">?</span> <span class="token punctuation">[</span>myPluginWithSnapshot<span class="token punctuation">]</span>
    <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>\u4E0A\u9762\u63D2\u4EF6\u4F1A\u9ED8\u8BA4\u542F\u7528\u3002\u5728\u53D1\u5E03\u9636\u6BB5\uFF0C\u4F60\u9700\u8981\u4F7F\u7528 webpack \u7684 <a href="https://webpack.js.org/plugins/define-plugin/" target="_blank" rel="noopener noreferrer">DefinePlugin</a> \u6216\u8005\u662F Browserify \u7684 <a href="https://github.com/hughsk/envify" target="_blank" rel="noopener noreferrer">envify</a> \u4F7F <code>process.<wbr>env.NODE_ENV !== &#39;production&#39;</code> \u4E3A <code>false</code>\u3002</p><h2 id="\u5185\u7F6E-logger-\u63D2\u4EF6" tabindex="-1">\u5185\u7F6E Logger \u63D2\u4EF6 <a class="header-anchor" href="#\u5185\u7F6E-logger-\u63D2\u4EF6" aria-hidden="true">#</a></h2><p>Vuex \u81EA\u5E26\u4E00\u4E2A\u65E5\u5FD7\u63D2\u4EF6\u7528\u4E8E\u4E00\u822C\u7684\u8C03\u8BD5:</p><div class="language-js"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createLogger <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vuex&#39;</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">createLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><code>createLogger</code> \u51FD\u6570\u6709\u51E0\u4E2A\u914D\u7F6E\u9879\uFF1A</p><div class="language-js"><pre><code><span class="token keyword">const</span> logger <span class="token operator">=</span> <span class="token function">createLogger</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">collapsed</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// \u81EA\u52A8\u5C55\u5F00\u8BB0\u5F55\u7684 mutation</span>
  <span class="token function">filter</span> <span class="token punctuation">(</span><span class="token parameter">mutation<span class="token punctuation">,</span> stateBefore<span class="token punctuation">,</span> stateAfter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u82E5 mutation \u9700\u8981\u88AB\u8BB0\u5F55\uFF0C\u5C31\u8BA9\u5B83\u8FD4\u56DE true \u5373\u53EF</span>
    <span class="token comment">// \u987A\u4FBF\uFF0C\`mutation\` \u662F\u4E2A { type, payload } \u5BF9\u8C61</span>
    <span class="token keyword">return</span> mutation<span class="token punctuation">.</span>type <span class="token operator">!==</span> <span class="token string">&quot;aBlocklistedMutation&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">actionFilter</span> <span class="token punctuation">(</span><span class="token parameter">action<span class="token punctuation">,</span> state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u548C \`filter\` \u4E00\u6837\uFF0C\u4F46\u662F\u662F\u9488\u5BF9 action \u7684</span>
    <span class="token comment">// \`action\` \u7684\u683C\u5F0F\u662F \`{ type, payload }\`</span>
    <span class="token keyword">return</span> action<span class="token punctuation">.</span>type <span class="token operator">!==</span> <span class="token string">&quot;aBlocklistedAction&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">transformer</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u5728\u5F00\u59CB\u8BB0\u5F55\u4E4B\u524D\u8F6C\u6362\u72B6\u6001</span>
    <span class="token comment">// \u4F8B\u5982\uFF0C\u53EA\u8FD4\u56DE\u6307\u5B9A\u7684\u5B50\u6811</span>
    <span class="token keyword">return</span> state<span class="token punctuation">.</span>subTree
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mutationTransformer</span> <span class="token punctuation">(</span><span class="token parameter">mutation</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// mutation \u6309\u7167 { type, payload } \u683C\u5F0F\u8BB0\u5F55</span>
    <span class="token comment">// \u6211\u4EEC\u53EF\u4EE5\u6309\u4EFB\u610F\u65B9\u5F0F\u683C\u5F0F\u5316</span>
    <span class="token keyword">return</span> mutation<span class="token punctuation">.</span>type
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">actionTransformer</span> <span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u548C \`mutationTransformer\` \u4E00\u6837\uFF0C\u4F46\u662F\u662F\u9488\u5BF9 action \u7684</span>
    <span class="token keyword">return</span> action<span class="token punctuation">.</span>type
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">logActions</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// \u8BB0\u5F55 action \u65E5\u5FD7</span>
  <span class="token literal-property property">logMutations</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// \u8BB0\u5F55 mutation \u65E5\u5FD7</span>
  <span class="token literal-property property">logger</span><span class="token operator">:</span> console<span class="token punctuation">,</span> <span class="token comment">// \u81EA\u5B9A\u4E49 console \u5B9E\u73B0\uFF0C\u9ED8\u8BA4\u4E3A \`console\`</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>\u65E5\u5FD7\u63D2\u4EF6\u8FD8\u53EF\u4EE5\u76F4\u63A5\u901A\u8FC7 <code>&lt;script&gt;</code> \u6807\u7B7E\u5F15\u5165\uFF0C\u5B83\u4F1A\u63D0\u4F9B\u5168\u5C40\u65B9\u6CD5 <code>createVuexLogger</code>\u3002</p><p>\u8981\u6CE8\u610F\uFF0Clogger \u63D2\u4EF6\u4F1A\u751F\u6210\u72B6\u6001\u5FEB\u7167\uFF0C\u6240\u4EE5\u4EC5\u5728\u5F00\u53D1\u73AF\u5883\u4F7F\u7528\u3002</p>`,24),e=[o];function c(u,l,r,i,k,d){return a(),s("div",null,e)}var f=n(p,[["render",c]]);export{g as __pageData,f as default};
